# Implementation Plan: prom-cli Core

**Branch**: `001-prom-cli-core` | **Date**: 2024-12-31 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-prom-cli-core/spec.md`

## Summary

Build a CLI tool for querying Prometheus from the terminal. Core features include:

- Server configuration with optional authentication
- List scrape targets with health status
- Execute instant PromQL queries
- Check server health status

Technical approach: Node.js + TypeScript with commander for CLI parsing and axios for HTTP requests.

## Technical Context

**Language/Version**: Node.js 18+ with TypeScript 5.x (ESM)
**Primary Dependencies**: commander (CLI), axios (HTTP)
**Storage**: JSON file (`~/.prom-cli/config.json`)
**Testing**: vitest (49 tests implemented)
**Target Platform**: macOS, Linux, Windows (Node.js runtime)
**Project Type**: Single CLI application
**Performance Goals**: Command init <100ms, API calls <5s (excluding network)
**Constraints**: Timeout configurable (default 30s), streaming for large results
**Scale/Scope**: Single user CLI tool, ~10 source files

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

| Principle             | Status      | Notes                                         |
| --------------------- | ----------- | --------------------------------------------- |
| I. Code Quality       | ✅ Pass     | Prettier + import sorting configured          |
| II. Testing Standards | ✅ Pass     | 49 tests implemented with vitest              |
| III. UX Consistency   | ✅ Pass     | Table/JSON output, --help, exit codes defined |
| IV. Performance       | ✅ Pass     | <100ms init, configurable timeout             |
| V. MVP First          | ✅ Pass     | P1-P4 prioritized, instant query only         |
| VI. No Overdesign     | ✅ Pass     | Simple structure, no premature abstractions   |

**Gate Result**: PASS - proceed to implementation

## Project Structure

### Documentation (this feature)

```text
specs/001-prom-cli-core/
├── plan.md              # This file
├── research.md          # Technology decisions
├── data-model.md        # Entity definitions
├── quickstart.md        # Usage guide
├── contracts/           # CLI command contracts
│   └── cli-commands.md
└── tasks.md             # (Generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/
├── index.ts             # CLI entry point (commander setup)
├── commands/            # Command handlers
│   ├── config.ts        # prom config
│   ├── targets.ts       # prom targets
│   ├── query.ts         # prom query
│   └── status.ts        # prom status
├── services/            # Business logic
│   ├── prometheus.ts    # Prometheus API client
│   └── config.ts        # Config file management
├── formatters/          # Output formatting
│   ├── table.ts         # Table formatter
│   └── json.ts          # JSON formatter
└── types/               # TypeScript interfaces
    └── index.ts         # All type definitions
```

**Structure Decision**: Single project structure - appropriate for CLI tool with ~10 source files. No need for monorepo or multi-package setup per Constitution Principle VI (No Overdesign).

## Generated Artifacts

| Artifact      | Path                                                     | Description                          |
| ------------- | -------------------------------------------------------- | ------------------------------------ |
| Research      | [research.md](./research.md)                             | Technology decisions and rationale   |
| Data Model    | [data-model.md](./data-model.md)                         | Entity definitions and relationships |
| CLI Contracts | [contracts/cli-commands.md](./contracts/cli-commands.md) | Command interface specifications     |
| Quickstart    | [quickstart.md](./quickstart.md)                         | Usage guide and validation checklist |

## Implementation Order (by User Story)

| Priority | Story            | Description               | Key Files                                       |
| -------- | ---------------- | ------------------------- | ----------------------------------------------- |
| P1       | Configure Server | Config save/load          | `services/config.ts`, `commands/config.ts`      |
| P2       | List Targets     | Fetch and display targets | `services/prometheus.ts`, `commands/targets.ts` |
| P3       | Execute Query    | PromQL instant query      | `commands/query.ts`, `formatters/table.ts`      |
| P4       | Check Status     | Health and build info     | `commands/status.ts`                            |

## Complexity Tracking

> No violations - design follows Constitution principles.

| Aspect           | Decision              | Rationale                                           |
| ---------------- | --------------------- | --------------------------------------------------- |
| Table formatting | Custom implementation | Avoid dependency for simple use case (Principle VI) |
| Config storage   | JSON file             | Human-readable, no additional dependencies          |
| Error handling   | axios interceptor     | Centralized, consistent error messages              |

## Next Step

Run `/speckit.tasks` to generate task breakdown for implementation.
